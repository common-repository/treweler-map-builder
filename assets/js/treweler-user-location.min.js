!function(){"use strict";function o(o,e,t){return e in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}window.TWER_GEOLOCATE={};class e{constructor(){o(this,"markerLocationProps",{id:0,marker_style:"default",point_halo_color:"#fff",point_halo_opacity:.5,point_color:"#4b7715",custom_marker_img:"",cursor:"pointer",anchor:"center"}),o(this,"geolocateButtonPressed",!1),this.initGeolocateControl(),this.hideGeolocateControl(),this.addGeolocateControlStyle(),this.setGeolocationMarkerStyle(),this.detectUserLocation()}setGeolocationMarkerStyle(){const o=this.getUserGeolocationMarkerTemplate();TWER.map.on("load",(()=>{if("default"===o)return!1;if(o){this.markerLocationProps={...this.markerLocationProps,...JSON.parse(o)};const e=this.markerLocationProps;if(document.createElement("div"),"default"===e.marker_style)window.TWER_GEOLOCATE._userLocationDotMarker._element.innerHTML=`<div class="treweler-marker"><div class="marker">\n                 <div class="marker-wrap">\n                 <div class="marker__shadow" style="background-color:${TWER.hex2rgba(e.point_halo_color,e.point_halo_opacity)}">\n                 <div class="marker__border" style="border-color:${e.point_color};">\n                 <div class="marker__center"></div>\n                 </div>\n                 </div>\n                 </div>\n                 </div></div>`;else if("dot-default"===e.marker_style){let o="";e.dot_icon_picker.length>0&&e.dot_icon_show>0&&(o=`<span class="marker-dot__icon material-icons" style="color:${e.dot_icon.color};font-size:${e.dot_icon.size}px;">${e.dot_icon_picker}</span>`),window.TWER_GEOLOCATE._userLocationDotMarker._element.innerHTML=`<div class="treweler-marker" style="width:${e.dot.size}px;height:${e.dot.size}px;border-radius:${e.dot_corner_radius.size}${e.dot_corner_radius.units};border:${e.dot_border.size}px solid ${e.dot_border.color};background-color:${e.dot.color};">${o}</div>`}else if("triangle-default"===e.marker_style){const o=`\n                        border-right-width:${e.triangle_width/2}px;\n                        border-left-width:${e.triangle_width/2}px;\n                        border-bottom-width: ${e.triangle_height}px;\n                        border-bottom-color: ${e.triangle_color};\n                        `;window.TWER_GEOLOCATE._userLocationDotMarker._element.innerHTML=`<div data-height="${e.triangle_height}" class="treweler-marker marker-triangle" style="${o}"></div>`}else if("balloon-default"===e.marker_style){const o=e.balloon.size+(e.balloon_border.size+e.balloon_border.size),t=(o+o-Math.sqrt(Math.pow(o,2)+Math.pow(o,2)))*(Math.sqrt(2)-1)/2;let r=`\n                        background-color: ${e.balloon.color};    \n                        border: ${e.balloon_border.size}px solid ${e.balloon_border.color};\n                        bottom:${t+t}px;                        \n                        width: ${e.balloon.size}px;\n                        height: ${e.balloon.size}px;`,a=`\n                        width:${e.balloon_dot.size}px;\n                        height:${e.balloon_dot.size}px;\n                        margin-left:${e.balloon_dot.size/2*-1}px;\n                        margin-top:${e.balloon_dot.size/2*-1}px;\n                        background-color:${e.balloon_dot.color};\n                        `,n="";e.balloon_icon_picker.length>0&&e.balloon_icon_show>0&&(n=`<span class="marker-balloon__icon material-icons" style="color:${e.balloon_icon.color};font-size:${e.balloon_icon.size}px;">${e.balloon_icon_picker}</span>`),window.TWER_GEOLOCATE._userLocationDotMarker._element.innerHTML=`<div data-width="${e.balloon.size}" data-height="${o+t+t}" class="treweler-marker marker-svg"><div class="marker-balloon" style="${r}"><div class="marker-balloon__dot" style="${a}">${n}</div></div></div>`,e.anchor="bottom"}else if("custom"===e.marker_style){const o=""!==e.custom_marker_size_default?e.custom_marker_size_default.split(";"):"42;42".split(";");window.TWER_GEOLOCATE._userLocationDotMarker._element.classList.add("treweler-marker"),window.TWER_GEOLOCATE._userLocationDotMarker._element.classList.add("icon"),window.TWER_GEOLOCATE._userLocationDotMarker._element.style.backgroundImage=`url('${e.custom_marker_img}')`,window.TWER_GEOLOCATE._userLocationDotMarker._element.style.backgroundSize="contain",window.TWER_GEOLOCATE._userLocationDotMarker._element.style.backgroundRepeat="no-repeat",window.TWER_GEOLOCATE._userLocationDotMarker._element.style.backgroundPosition="center center";const t=parseInt(o[1])<=42?parseInt(o[1])%2==0?parseInt(o[1]):parseInt(o[1])+1:42,r=parseInt(o[0])<=42?parseInt(o[0])%2==0?parseInt(o[0]):parseInt(o[0])+1:42,a=parseInt(e.custom_marker_size)>1?parseInt(e.custom_marker_size):t,n=parseInt(e.custom_marker_size)>1?parseInt(e.custom_marker_size):r;window.TWER_GEOLOCATE._userLocationDotMarker._element.style.width=`${a}px`,window.TWER_GEOLOCATE._userLocationDotMarker._element.style.height=`${n}px`,e.anchor=e.custom_marker_position}else window.TWER_GEOLOCATE._userLocationDotMarker._element.innerHTML=`<div class="treweler-marker"><div class="marker">\n                 <div class="marker-wrap">\n                 <div class="marker__shadow" style="background-color:${TWER.hex2rgba(e.point_halo_color,e.point_halo_opacity)}">\n                 <div class="marker__border" style="border-color:${e.point_color};">\n                 <div class="marker__center"></div>\n                 </div>\n                 </div>\n                 </div>\n                 </div></div>`,e.anchor="center";window.TWER_GEOLOCATE._userLocationDotMarker._element.classList.add("js-twer-marker"),window.TWER_GEOLOCATE._userLocationDotMarker._element.setAttribute("id",`twer-popup-id-${e.id}`),window.TWER_GEOLOCATE._userLocationDotMarker._element.classList.add(`twer-cursor-${e.cursor}`),window.TWER_GEOLOCATE._userLocationDotMarker._element.classList.add(`twer-marker-type--${e.marker_style}`)}else window.TWER_GEOLOCATE._userLocationDotMarker._element.classList.add("d-none")}))}detectUserLocation(){TWER.map.on("load",(()=>{this.isUserAutoGeolocation()&&(window.TWER_GEOLOCATE.trigger(),window.TWER_GEOLOCATE._geolocateButton.addEventListener("click",(o=>{if(this.geolocateButtonPressed)return!1;if(this.geolocateButtonPressed=!0,!this.isCenteredMapOnLoadUserLocation()&&this.isUserAutoGeolocation()){const o=window.TWER_GEOLOCATE._lastKnownPosition,e=new mapboxgl.LngLat(o.coords.longitude,o.coords.latitude),t=o.coords.accuracy,r=TWER.map.getBearing(),a=this.extend({bearing:r},{maxZoom:15});TWER.map.fitBounds(e.toBounds(t),a,{geolocateSource:!0}),window.TWER_GEOLOCATE._watchState="ACTIVE_LOCK",window.TWER_GEOLOCATE._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),window.TWER_GEOLOCATE._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active"),window.TWER_GEOLOCATE._updateCamera=o=>{const e=new mapboxgl.LngLat(o.coords.longitude,o.coords.latitude),t=o.coords.accuracy,r=TWER.map.getBearing(),a=this.extend({bearing:r},{maxZoom:15});TWER.map.fitBounds(e.toBounds(t),a,{geolocateSource:!0})}}})))}))}extend(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];for(const e of t)for(const t in e)o[t]=e[t];return o}initGeolocateControl(){window.TWER_GEOLOCATE=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},showUserLocation:!0,showAccuracyCircle:"default"===this.getUserGeolocationMarkerTemplate(),trackUserLocation:!0,showUserHeading:!0}),TWER.map.addControl(window.TWER_GEOLOCATE,TWER.data.geolocateControlPosition),!this.isCenteredMapOnLoadUserLocation()&&this.isUserAutoGeolocation()&&(window.TWER_GEOLOCATE._updateCamera=o=>{const e=TWER.map.getCenter(),t=o.coords.accuracy,r=TWER.map.getBearing(),a=this.extend({bearing:r},{maxZoom:TWER.map.getZoom(),animate:!1});TWER.map.fitBounds(e.toBounds(t),a,{geolocateSource:!1})})}addGeolocateControlStyle(){"treweler-style"===TWER.data.geolocateControlStyle&&window.TWER_GEOLOCATE._container.classList.add("twer-geolocation-control")}hideGeolocateControl(){if(this.isGeolocateControl())return!1;window.TWER_GEOLOCATE._container.style.display="none"}isEnableGeolocation(){return this.isUserAutoGeolocation()||this.isGeolocateControl()}isUserAutoGeolocation(){return TWER.data.userGeolocation}isGeolocateControl(){return TWER.data.geolocateControl}isCenteredMapOnLoadUserLocation(){return TWER.data.userGeolocationCenteredMapOnLoad}getUserGeolocationMarkerTemplate(){return TWER.data.userGeolocationMarkerTemplate}}window.addEventListener("load",(()=>{new e}))}();