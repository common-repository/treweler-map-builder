!function(){"use strict";class t{getInitialMarkerType(){return TWER.data.directions.startDirectionsMarker||"user-geolocation"}constructor(){var t,e;e=[],(t="startCoordinates")in this?Object.defineProperty(this,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):this[t]=e,this.directions=new MapboxDirections({accessToken:mapboxgl.accessToken,unit:"metric",profile:`mapbox/${TWER.data.directions.profile}`,interactive:!1,controls:!1,flyTo:!0,styles:[{id:"directions-route-line-alt",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#bbb","line-width":4},filter:["all",["in","$type","LineString"],["in","route","alternate"]]},{id:"directions-route-line-casing",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#2d5f99","line-width":0},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-route-line",type:"line",source:"directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":{property:"congestion",type:"categorical",default:"#18af1f",stops:[["unknown","#18af1f"],["low","#18af1f"],["moderate","#18af1f"],["heavy","#18af1f"],["severe","#18af1f"]]},"line-width":3},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-origin-point",type:"circle",source:"directions",paint:{"circle-opacity":0,"circle-stroke-opacity":0},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-origin-label",type:"symbol",source:"directions",layout:{"text-field":"A","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":0},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-destination-point",type:"circle",source:"directions",paint:{"circle-opacity":0,"circle-stroke-opacity":0},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]},{id:"directions-destination-label",type:"symbol",source:"directions",layout:{"text-field":"B","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":0},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]}]}),this.directions.on("route",(t=>{document.getElementById("js-twer-directions").classList.remove("d-none")})),TWER.map.addControl(this.directions,"top-left"),TWER.map.addControl(this.resetIcon(),TWER.data.directions.resetIconPosition),TWER.map.on("load",(()=>{switch(this.getInitialMarkerType()){case"user-geolocation":window.TWER_GEOLOCATE.on("geolocate",(t=>{this.setStartCoordinates([t.coords.longitude,t.coords.latitude])}));break;case"manual-location":this.setStartCoordinates(TWER.data.center)}void 0!==TWER.storeLocator&&TWER.storeLocator.on("result",(t=>{this.setStartCoordinates(t.result.center)}))})),TWER.map.on("click",(t=>{let e=t.lngLat.toArray();const i=t.originalEvent.target;if(this.isUserLocationMarker(i))return!1;if(this.isMarker(i)){for(const t of TWER.clusterData.features){const n=this.getMarkerByTarget(i);parseInt(n.id.replace("twer-popup-id-",""))===t.properties.id&&(e=t.geometry.coordinates)}this.makeDirection(e)}else"manual-location"===this.getInitialMarkerType()&&this.setStartCoordinates(e)}))}removeAllDirections(){this.directions.removeRoutes(),this.setStartCoordinates(this.startCoordinates)}makeDirection(t){if(lodash.isEmpty(this.startCoordinates))return!1;this.directions.setOrigin(this.startCoordinates),this.directions.setDestination(t)}setStartCoordinates(t){this.startCoordinates=t,lodash.isEmpty(this.directions.getDestination())||this.directions.setOrigin(t)}getMarkerByTarget(t){let e=t.closest(".js-twer-marker");return null===e?t:e}isUserLocationMarker(t){var e;let i=!1;return(t.classList.contains("mapboxgl-user-location")||null!==(e=t.closest(".mapboxgl-user-location"))&&void 0!==e&&e.classList.contains("js-twer-marker"))&&(i=!0),i}isMarker(t){var e;let i=!1;return(t.classList.contains("js-twer-marker")||t.classList.contains("treweler-marker")||null!==(e=t.closest(".js-twer-marker"))&&void 0!==e&&e.classList.contains("js-twer-marker"))&&(i=!0),i}resetIcon(t){const e=this;return{onAdd(t){return this._map=t,this._btn=document.createElement("button"),this._btn.className="btn btn-outline-dark twer-directions__reset-btn d-flex align-items-center justify-content-center",this._btn.type="button",this._btn.innerHTML='<svg class="twer-svg-icon" width="18" height="17"><use xlink:href="#reset-directions"></use></svg>',this._btn.onclick=t=>{t.preventDefault(),lodash.isEmpty(e.directions.getDestination())||(e.removeAllDirections(),document.getElementById("js-twer-directions").classList.add("d-none"))},this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl-group mapboxgl-ctrl twer-directions d-none",this._container.id="js-twer-directions",this._container.appendChild(this._btn),this._container},onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}}}window.addEventListener("load",(()=>{new t}))}();